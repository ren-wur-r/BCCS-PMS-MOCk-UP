# 單一/混合專案類型規劃（合約/專案類型與標準階段整合）

目的：讓「合約類型/標準階段」能支援跨部門服務（混合專案），並在建立專案時自動生成可追蹤的標準階段與 Milestone；同時強制上傳訂單內容/合約 SLA 以符合合規需求。

---

## 1. 名詞與方向建議

### 建議命名

- 原「合約類型」改為「專案類型」（已確認）
  - 專案類型 = 客戶合約/訂單的交付型態
  - 類型下綁定「服務模組/標準階段模板」

### 專案類型分類

- 單一專案（Single）
  - 只能選一個標準階段模板
- 混合專案（Hybrid）
  - 可複選多個標準階段模板（跨部門/跨服務）
  - 分里程碑呈現（已確認）

---

## 2. 核心規則

1. 建立專案類型時，必須同步建立/綁定其標準階段模板
2. 混合專案允許跨部門模板組合（如顧問 ISMS + 工程部資安健診）
3. 建立專案時必須上傳訂單內容或合約 SLA（必填）
4. 專案建立後即產生 Milestone（依模板產出），並可追蹤進度/提醒

---

## 3. 資料結構（前端先行、後端待補）

### ProjectType（專案類型）

- id
- name
- category: "single" | "hybrid"
- departments: [DepartmentRef]（可多部門）
- stageTemplateIds: [StageTemplateRef]（由服務項目帶出）
- serviceItemIds: [ServiceItemRef]（選擇服務項目後，再帶出模板）
- requiredAttachments:
  - order: boolean
  - sla: boolean
- status: active/inactive
- updatedAt

### ServiceItem（服務項目）

- id
- name（例：資安健診、顧問服務、技服檢測）
- departmentScope: [DepartmentRef]
- stageTemplateIds: [StageTemplateRef]

### StageTemplate（標準階段模板）

- id
- name
- departmentId
- description
- stages: Stage[]
- defaultMilestones: MilestoneRef[]（可對應里程碑）
- updatedAt

### Stage（階段）

- id
- name
- definitionOfDone
- outputs: OutputItem[]
- alertRules:
  - notifySupervisorDays: number (ex: 5)
  - notifyGMDays: number (ex: 3)

### OutputItem（產出）

- id
- name
- required: boolean
- evidenceType: "file" | "link" | "form"

### Project

- id
- projectTypeId
- projectTypeCategory
- contractFiles: FileRef[]
- assignedTemplates: StageTemplateRef[]
- generatedMilestones: Milestone[]
- stageInstances: StageInstance[]

---

## 4. 模組規劃（系統設置）

### 4.1 專案類型管理（取代原合約類型）

功能

- 新增/編輯/停用專案類型
- 設定「單一/混合」類型
- 綁定部門
- 綁定服務項目（Single=單選、Hybrid=複選）
- 強制上傳設定（訂單/合約 SLA）

UI 建議

- 類型名稱 + 類型分類 + 部門
- 服務項目選擇器（依部門分類）
- 服務項目帶出標準階段模板（只讀預覽）
- 合規附件需求（Order/SLA 체크）

### 4.2 標準階段模板管理

功能

- 新增/編輯模板（可選部門）
- 階段（可排序）
- 每階段輸入 DoD 與必填產出
- 預設 Milestone 對應

UI 建議

- 左側模板清單，右側階段明細
- 階段卡片式（含 DoD/產出/提醒）

---

## 5. 標準階段模板範本（依 isDiagnostic.md）

模板名稱：資安健診標準流程
部門：顧問/資安（可依組織調整）

1. 專案啟始與定義
   - 產出：工作計畫書、啟始會議紀錄、專案基本資訊表
2. 資料準備與檢測規劃
   - 產出：受測系統清單、檢測項目對照表、檢測計畫文件、資料蒐集需求清單
3. 現場執行與資料蒐集
   - 產出：原始檢測資料、檢測行動紀錄、訪談/現場確認紀錄
4. 初步分析與風險分級
   - 產出：弱點/問題清單、風險分級表、問題分類統計、初步改善摘要
5. 結果確認與收斂
   - 產出：結果確認會議紀錄、修正後清單、改善優先順序
6. 結案準備與交付
   - 產出：執行紀錄彙整包、資料集、會議/決策紀錄、結案確認文件

提醒規則（套用到每階段）

- 距截止 5 天：通知直屬主管
- 距截止 3 天：通知總經理 + 風險標示

---

## 6. 專案管理 Milestone（依 mileStone.md）

Milestone 0~7 對應資安健診流程：

- M0：專案已立案
- M1：專案啟始完成 → 對應「專案啟始與定義」
- M2：檢測規劃完成 → 對應「資料準備與檢測規劃」
- M3：現場檢測完成 → 對應「現場執行與資料蒐集」
- M4：初步分析完成 → 對應「初步分析與風險分級」
- M5：結果確認完成 → 對應「結果確認與收斂」
- M6：結案資料備妥 → 對應「結案準備與交付」
- M7：專案正式結案

---

## 7. 使用者流程（描述）

### 7.1 系統設置流程（專案類型 / 模板）

1. 系統設置 > 專案類型
2. 新增專案類型
3. 選擇「單一/混合」類型
4. 綁定部門
5. 選擇服務項目（Single=單選 / Hybrid=複選）
6. 服務項目帶出標準階段模板（可檢視不可修改）
7. 勾選合規附件需求（訂單/合約 SLA）
8. 儲存

### 7.2 建立專案流程

1. 專案建立來源是商機 100%成案後以及自己新增專案 > 選擇專案類型
2. 選擇服務項目（依專案類型可單選/複選）
3. 系統顯示必填附件（訂單/合約 SLA）
4. 上傳附件（必填才可下一步；允許 PDF/Word/PNG，PDF 優先）
5. 如果是商機成案的專案，會依照業務地區顯示同區的各負責部門人員，如果是自個人新增的專案，則依「新增人之地區」預設顯示同區部門
6. 若需跨區合作，允許重選部門
7. 自動生成階段與 Milestone（分里程碑、分部門）
8. 指派負責人/執行者
9. 完成建立

### 7.3 專案執行流程（混合專案）

1. 進入專案 > Milestone/階段總覽
2. 以「部門里程碑」區分（分里程碑呈現）
3. 每階段填寫工作日誌 + 上傳產出
4. 逾期提醒觸發（主管/總經理）
5. 風險專案標示

---

## 8. 介面呈現建議

### 專案類型設定頁

- 標籤：單一 / 混合
- 右側「服務項目」多選區（分部門分組）
- 選擇服務項目後，顯示對應標準階段模板（只讀預覽）
- 合規附件需求區塊（必填）

### 專案建立頁

- 選類型後顯示：
  - 服務項目摘要（部門 + 階段數量）
  - 附件上傳（訂單/合約 SLA，允許 PDF/Word/PNG）
  - 預覽生成的 Milestone（分部門）

### 專案詳情頁

- 頂部：專案類型 + 服務項目 chips
- 里程碑與階段分頁（分部門）
- 每階段：產出檢核 + 工作日誌 + 附件狀態

---

## 9. 待確認點

1. 合約類型改名為「專案類型」（已確認）
2. 混合專案分里程碑呈現（已確認）
3. 合規附件允許 PDF/Word/PNG（PDF 優先）（已確認）
4. 是否需「部門權限」限制模板可見與可選範圍

---

## 10. 結論

此規劃讓專案類型與標準階段強綁定，同時支援單一/混合交付模式，並透過附件合規與 Milestone 追蹤確保專案可管控與可稽核。若確認此規劃，可再進行系統設置頁面與專案管理流程的實作。
