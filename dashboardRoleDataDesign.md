# 角色儀表板資料來源對應設計

> 目的：釐清各角色儀表板 KPI 的資料來源模組與計算邏輯，確保指標與使用者職責一致。
> 範圍：以目前前端可用 mock 資料為基準，並定義未來串接 API 的對應點。

---

## 共用原則

- 儀表板指標需對應「角色日常操作的模組」。
- 角色切換時只顯示該角色關心的 KPI，不顯示無關資訊（例：電銷不顯示專案總數）。
- mock 階段以 `mockDataSets` 與 localStorage cache 為資料來源；上線後替換為 API。

---

## 資料來源總表（模組 → 資料）

- 電銷管理（TeleSale）

  - 來源：`CrmPhonePipelineList` 的 mock 名單資料（前端暫存）
  - 類型：名單、產業、狀態、來源、價值、黑名單（不再聯繫）

- 活動管理（Activity）

  - 來源：`mockDataSets.crmActivities`
  - 類型：活動總數、活動類型、近期活動、活動名單狀態

- 商機管理（Pipeline）

  - 來源：`mockDataSets.crmPipelines` + `cache.crm.pipeline.*`
  - 類型：10/30/70/100、轉案、失敗、負責業務、預估金額

- 專案管理（WorkProject）

  - 來源：`mockDataSets.workProjects` + `cache.work.project.snapshot`
  - 類型：專案數、風險狀態（未開始/如期/注意/延遲）、部門/區域

- 待接單（Handoff）
  - 來源：`cache.crm.pipeline.handoff.queue`
  - 類型：待接單數、轉入商機數、待處理清單

---

## 角色儀表板設計對應

### Admin

- 來源模組：全部（統合）
- KPI（建議）：公司專案總數、商機分布、部門專案風險
- 說明：整體監控，不做角色限制。

### 總經理

- 來源模組：Dashboard 統合 + 商機管理 + 專案管理
- KPI（建議）：
  - 商機 10/30/70/100 分布（圓餅/卡片）
  - 專案風險分布（如期/注意/延遲）
  - 公司總毛利 / 專案總數
- 附加：可依區域篩選（北/中/南）。

### 各處處長

- 來源模組：本處相關模組彙整（電銷、活動、專案、商機）
- KPI（建議）：
  - 電銷轉業務數
  - 活動 → 電銷轉換數
  - 專案成案比例
- 設計重點：跨部門統整，但只能管理本處。

### 各部門經理

- 來源模組：專案管理 + 專案標準階段
- KPI（建議）：
  - 部門專案數
  - 部門風險分布
  - 未指派任務數（若有指派模組）
- 設計重點：只能管理部門內專案與指派。

### 活動人員

- 來源模組：活動管理
- KPI（建議）：
  - 近期活動數
  - 活動類型分布
  - 活動名單狀態（待電銷/已電銷/已派送）
- 設計重點：聚焦活動成效與名單狀態。

### 電銷人員

- 來源模組：電銷管理
- KPI（建議）：
  - 名單總數
  - 名單狀態分布（待聯繫/已聯繫/已約訪/已派送/不再聯繫）
  - 產業分布（Top 3）
  - 黑名單（不再聯繫）
- 設計重點：只看名單與撥打狀況，不顯示專案/商機毛利。

### 顧問

- 來源模組：專案管理
- KPI（建議）：
  - 我參與的專案數
  - 專案風險分布
- 設計重點：專案執行狀況為主。

### 資深顧問

- 來源模組：專案管理
- KPI（建議）：
  - 我參與的專案數
  - 專案風險分布
- 設計重點：與顧問一致，必要時可加「待審核產出數」。

### 產品經理

- 來源模組：專案管理 + 商機管理（陪同簡報）
- KPI（建議）：
  - 本月陪同簡報次數（mock 欄位）
  - 產品線專案數（若 mock 有對應）
- 設計重點：以產品支持與成案轉換為主。

### 工程師

- 來源模組：專案管理
- KPI（建議）：
  - 我參與的專案數
  - 專案風險分布
- 設計重點：工作負載與風險。

---

## Mock → API 對應建議

- Dashboard 目前由 `mbsDashboardHttpGetInfo` 統一取得。
- 離線時以 `buildDashboardMockData` 生成基礎指標。
- 若角色需要模組專屬指標：
  - 電銷：改為直接從 `crmPhone` 模組端點或 mock list 計算。
  - 活動：改從 `crmActivity` 端點或 mock list 計算。
  - 專案：改從 `workProject` 端點或 mock list 計算。

---

## 後續需確認事項

- 各角色 KPI 最終清單：待確認。
- 部門/區域過濾規則（是否以登入者部門/區域為主）：是。
- 是否需要「個人/部門/全公司」切換 ：不用
