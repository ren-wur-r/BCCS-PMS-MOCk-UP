# 第一階段需求分析報告：Menu 與 Dashboard

## 1. 概述

本報告針對「第一階段 - Menu（側欄菜單） and Dashboard（首頁）」之需求進行現況比對與可行性分析。

## 2. Menu（側欄菜單）調整

### 2.1 現況與需求比對

| 項目         | 現況 (Current)                                  | 需求 (Target)                                   | 差異分析                                         |
| :----------- | :---------------------------------------------- | :---------------------------------------------- | :----------------------------------------------- |
| **群組名稱** | `CRM`                                           | `行銷管理`                                      | 僅需修改前端顯示名稱 (Label)。                   |
| **群組名稱** | `工作`                                          | `專案管理`                                      | 僅需修改前端顯示名稱 (Label)。                   |
| **結構**     | `CRM` 下包含 `商機管理`、`電銷管理`、`活動管理` | `行銷管理` 下需包含 `活動管理` (及其他既有項目) | 現況已包含活動管理，無需額外調整結構，僅需改名。 |

### 2.2 執行方案

- **可行性**：**高** (立即執行)。
- **修改範圍**：`FrontEnd/manager-back-site/src/components/global/layout/Sidebar.vue`。
- **動作**：
  1.  將 `groupTitle: "CRM"` 修改為 `groupTitle: "行銷管理"`。
  2.  將 `groupTitle: "工作"` 修改為 `groupTitle: "專案管理"`。

---

## 3. Dashboard（首頁）調整

### 3.1 現況與需求比對

| 項目                   | 現況 (Current)                        | 需求 (Target)                                    | 差異分析                                                                                             |
| :--------------------- | :------------------------------------ | :----------------------------------------------- | :--------------------------------------------------------------------------------------------------- |
| **首頁內容**           | 空白 (`<h1>首頁</h1>`)                | 依據 16 種不同角色顯示客製化儀表板               | 需從零開發前端頁面與後端 API。                                                                       |
| **資料欄位：風險等級** | 系統已有自動判斷邏輯 (Delayed/AtRisk) | 需依風險等級 (綠/黃/紅) 顯示專案數量             | **已確認**：無需新增欄位。直接沿用現有排程邏輯 (延遲=紅, 注意=黃, 如期=綠) 進行統計。                |
| **資料欄位：毛利**     | 已有 `ClosingPrice` 與 `CostPrice`    | 顯示公司/個人/各區毛利                           | **已確認**：計算邏輯確立 (成交價 - 成本)。可直接進行統計。                                           |
| **資料欄位：證照數**   | 無證照資料                            | 顯示各區/部門人員證照數                          | **缺口**：無資料庫人力。**對策**：前端開發 CSV 匯入功能並建立 Mock Data，後端僅預留 Interface 接口。 |
| **功能：公告**         | 無此功能                              | 特定主管可發布公告、首頁顯示公告 (純文字/可關閉) | **缺口**：需新增 `Announcement` 資料表 (需確認是否比照證照模式先做前端，或等待 DB 人力)。            |
| **功能：角色判斷**     | 透過 `LoginToken` 與權限表            | 依據 16 種角色 (總經理, 業務, 處長...) 切換視圖  | 需確認系統如何識別這些特定角色 (是透過 Role Name 字串比對? 還是新增特定權限標籤?)。                  |

### 3.2 角色視圖分析 (摘要)

需求定義了極為細緻的角色視圖，以下為主要缺口標記：

1.  **總經理 (GM)**
    - _缺口_：公告功能、專案/客戶類型分布統計 API。
    - _已解決_：毛利與風險等級可透過現有資料計算。
2.  **業務 (Sales)**
    - _已解決_：個人毛利可計算。
3.  **各級主管 (處長/經理)**
    - _缺口_：部門/區域維度的統計 API。
    - _對策_：證照資料改採前端匯入 CSV 暫存模式。
4.  **行銷處長**
    - _缺口_：PM 陪同數據 (需在 Pipeline 新增 PM 欄位)、轉電/轉業務成功率統計 API。
5.  **一般人員 (顧問/工程師/等)**
    - _已解決_：個人專案風險檢視 (沿用系統邏輯)。

### 3.3 執行方案建議

建議分為以下步驟：

#### 步驟一：基礎建設 (資料面補強)

1.  **證照資料 (Frontend First)**：
    - 前端：開發 CSV 匯入解析功能，將資料暫存於前端 Store 或 LocalStorage 以供 Demo/統計使用。
    - 後端：僅定義 `IEmployeeCertificateService` 介面，暫不實作 DB 存取。
2.  **新增資料欄位** (需修改 Database & Backend Model)：
    - `Pipeline` 表：新增 `ProductManagerID` (產品經理) 欄位，以支援陪同數據統計。
    - `System`：新增 `Announcement` (公告) 資料表 (若此部分也無 DB 人力，則比照證照辦理)。

#### 步驟二：後端 API 開發

1.  建立 `DashboardController`。
2.  實作 `GetDashboardData` API：
    - 聚合邏輯：整合現有 `Project` (風險)、`Pipeline` (毛利) 資料。
    - Mock 介面：針對證照數據，若後端未實作，則由前端自行處理或 API 回傳 Mock 數據。

#### 步驟三：前端頁面開發 (`Home.vue`)

1.  實作動態 Component 加載。
2.  實作 CSV 匯入功能 (針對證照)。
3.  實作各類圖表 (Chart.js)。

## 4. 結論

**Menu 修改**可立即進行。
**Dashboard 開發** 風險與毛利邏輯已確認。證照部分將優先開發前端匯入 CSV 功能以展示成果，後端僅留接口待人力補齊。

### 下一步建議

1.  請確認是否同意修改 Menu 名稱。
2.  針對 Dashboard：
    - 公告系統是否也比照證照模式 (前端暫存)？OK,confirmed.
    - 確認「角色識別」的具體規則 (例如：是否直接用 Role Name "總經理" 判斷？)。若目前 codebase 裡面有的請按照 codebase。
